## 이슈발생

1. addEventListener로 화면 클릭시 메뉴가 꺼지도록 설정하려고 했다. 그러나 react를 통해 이벤트를 관리하지 않은 탓에 예상처럼 동작하지 않았고 내 상식에 있던 버블링 캡쳐링 기능이 동작하지 않았다.

2. 드롭다운 메뉴나 상호작용 가능한 버튼들을 대부분 라이브러리 없이 처리했지만, 문제는 작성하는데 너무 오래걸렸다. 예를 들면, 헤더에서 autofill과 nvaMenu를 작성하고 외부 레이아웃 클릭시 종료되도록 설정하느랴 5일은 걸린 듯하다.

## 경과

1. 문제점을 발견했다. react 구조상 실제 dom의 모든 이벤트의 버블링이 완료된 후, react에서 이벤트를 위임받아 모든 이벤트를 캡쳐링 방식으로 처리하고 있다는 점이였다. 그러므로 당연히 버블링을 기반으로 짰던 내 코드는 생각대로 돌아가지 않았다.

   - 예상치못한 부작용을 감안해서 코드를 짰음에도 문제가 발생했는데, addEventListener만으로 처리했고 추가적으로 react 컴포넌트에 onEvent를 추가해줬는데 addEventListener에서 이벤트 전파를 막고 있고 버블링 종료 후에 이벤트가 실행되는 react 특성상 onEvent가 동작하지 않았다.

   - 추가적으로 쓸데없이 구조도 복잡해지고, useEffect와 useRef를 남용해서 쓸데없이 메모리의 소비가 추가적으로 증가했다.

2. accordion이나 모달을 좀 더 쉽게 처리하기 위해 mui 라이브러리를 추가하려 한다.

https://mui.com/material-ui/react-menu/

## 해결

1. 옵저버 패턴과 zustand 라이브러리를 활용했다.

   - 옵저버 패턴으로 이벤트를 추가하고 클릭 이벤트가 발생할 때마다 notify가 되어 실행되게 해주었고, 그 과정을 효율적으로 처리하기 위해 zustand 전역상태 관리 라이브러리를 활용하여 observable을 관리하고 observer들을 subscribe 및 unsubscribe가 가능하게 해줬다.

   - 덕분에 구조가 훨씬 간결해지고 예상치 않았지만 부작용으로 쓸데없이 남용되던 useEffect와 useRef의 수를 줄일 수가 있었다.
